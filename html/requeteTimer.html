<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <title>Requete</title>
</head>
<body>
</br>
    <div class="container-fluid">
      <h3>Timer</h3>
      <hr>

      <button class="btn btn-success" onclick="commencer()"> Démarrer</button>
      <i class="fa fa-circle" aria-hidden="true" id="status"></i>
      <button class="btn btn-danger" onclick="arreter()">Arrêter</button>
      <h2 id="chrono"></h2>
    </div>

    <script>
       let interval;

      function commencer(){
          const req = new XMLHttpRequest();

          req.onreadystatechange = function(event) {
              // XMLHttpRequest.DONE === 4
              if (this.readyState === XMLHttpRequest.DONE) {
                  var flag = 1;
                  if (this.status === 200) {
                      console.log("Réponse reçu: %s", this.responseText);
                      interval = setInterval( sendRequest, 1000 )
                  } else {
                      console.log("Status de la réponse: %d (%s)", this.status, this.statusText);
                  }
              }
          };

          req.open('GET', 'scriptTimerStart.php', true);
          req.send(null);
      }

      function sendRequest(){
          document.getElementById("status").style.color = "red";
          const req = new XMLHttpRequest();

          req.onreadystatechange = function(event) {
              // XMLHttpRequest.DONE === 4
              if (this.readyState === XMLHttpRequest.DONE) {
                  if (this.status === 200) {
                      console.log("Réponse reçu: %s", this.responseText);
                      let val = JSON.parse(this.responseText);
                      if ( val.duree !== -1 ) {
                          document.getElementById('chrono').innerHTML = '' + val.duree + ' "';
                      }
                  } else {
                      console.log("Status de la réponse: %d (%s)", this.status, this.statusText);
                  }
              }
          };

          req.open('GET', 'scriptTimerRead.php', true);
          req.send(null);
      }


      function arreter() {
          document.getElementById("status").style.color = "green";
          clearInterval( interval );
      }
    </script>


</body>
</html>
